<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/someipy/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/someipy/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/someipy/assets/js/vendor/lunr.min.js"></script> <script src="/someipy/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Getting Started | someipy</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Getting Started" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="someipy is a Python library implementing the SOME/IP protocol. Spinning up a SOME/IP service takes only a few minutes. someipy is perfectly suited for fast prototyping of applications that need to provide or use SOME/IP services." /> <meta property="og:description" content="someipy is a Python library implementing the SOME/IP protocol. Spinning up a SOME/IP service takes only a few minutes. someipy is perfectly suited for fast prototyping of applications that need to provide or use SOME/IP services." /> <link rel="canonical" href="https://chrizog.github.io/someipy/" /> <meta property="og:url" content="https://chrizog.github.io/someipy/" /> <meta property="og:site_name" content="someipy" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Getting Started" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebSite","description":"someipy is a Python library implementing the SOME/IP protocol. Spinning up a SOME/IP service takes only a few minutes. someipy is perfectly suited for fast prototyping of applications that need to provide or use SOME/IP services.","headline":"Getting Started","name":"someipy","url":"https://chrizog.github.io/someipy/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/someipy/" class="site-title lh-tight"> someipy </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/someipy/" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="/someipy/CHANGELOG.html" class="nav-list-link">CHANGELOG</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/chrizog/someipy" class="nav-list-link external" > someipy on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search someipy" aria-label="Search someipy" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/chrizog/someipy" class="site-button" > someipy on GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 class="fs-9" id="using-someip-has-never-been-easier"> <a href="#using-someip-has-never-been-easier" class="anchor-heading" aria-labelledby="using-someip-has-never-been-easier"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using SOME/IP has never been easier </h1> <p class="fs-6 fw-300">With someipy, spinning up a SOME/IP service only takes five minutes.</p> <p><a href="#getting-started" class="btn btn-primary fs-5 mb-4 mb-md-0 mr-2">Get started now</a> <a href="https://github.com/chrizog/someipy" class="btn fs-5 mb-4 mb-md-0">View it on GitHub</a></p> <p>someipy is a Python library implementing the SOME/IP protocol, including the SOME/IP Service Discovery. Itâ€™s perfectly suited for fast prototyping of applications that need to provide SOME/IP services to other ECUs or use SOME/IP services from other ECUs.</p> <p>someipy also supports serialization and deserialization of SOME/IP payloads, a unique feature of someipy.</p> <p>someipy is still under development; therefore, it does not yet support all features of the SOME/IP and SOME/IP Service Discovery protocol specification.</p> <p>someipy is based on the specification version of R22-11:</p> <ul> <li><a href="https://www.autosar.org/fileadmin/standards/R22-11/FO/AUTOSAR_PRS_SOMEIPProtocol.pdf">SOME/IP Protocol Specification</a></li> <li><a href="https://www.autosar.org/fileadmin/standards/R22-11/FO/AUTOSAR_PRS_SOMEIPServiceDiscoveryProtocol.pdf">SOME/IP Service Discovery Protocol Specification</a></li> </ul> <p>The library is developed and tested on Ubuntu 22.04 and using Python 3.8.</p> <h1 id="get-in-contact"> <a href="#get-in-contact" class="anchor-heading" aria-labelledby="get-in-contact"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Get in Contact </h1> <p>If you want to connect, have a feature request, bug report or need support, send me an email or connect on LinkedIn:</p> <blockquote> <p><a href="mailto:someipy.package@gmail.com">someipy.package@gmail.com</a><br /> <a href="https://www.linkedin.com/in/ch-herzog/">LinkedIn</a></p> </blockquote> <h1 id="getting-started"> <a href="#getting-started" class="anchor-heading" aria-labelledby="getting-started"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting Started </h1> <p>In this section, you will learn how to setup someipy and write an application that offers a service with an event which is fired every second. A datatype to be serialized for the event data is defined as well.</p> <p>Requirements:</p> <ul> <li>Linux, e.g. Ubuntu 22.04</li> <li>Python &gt;= Python 3.8</li> </ul> <p>The full application source code can also be found in the <a href="https://github.com/chrizog/someipy/blob/master/example_apps/send_events_udp.py">someipy example applications</a>.</p> <h2 id="installation"> <a href="#installation" class="anchor-heading" aria-labelledby="installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installation </h2> <p>someipy can be installed from the <a href="https://pypi.org/project/someipy/">Python Package Index</a> using pip. someipy has no further dependencies, allowing a smooth integration into your project.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 <span class="nb">install </span>someipy
</code></pre></div></div> <h2 id="service-datatype-definition"> <a href="#service-datatype-definition" class="anchor-heading" aria-labelledby="service-datatype-definition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Service Datatype Definition </h2> <p>Before implementing the actual application, we will first define a datatype called <em>TemperatureMsg</em> to be used for the SOME/IP event. In someipy no special IDL (interface description language) is needed like Franca IDL or ARXML files. The interface datatypes are simply written in Python.</p> <p>We will define a datatype <em>TemperatureMsg</em>, that consists of another datatype <em>Version</em>, a 64-bit timestamp and an array containing four 32-bit floating type measurements. The datatype is declared by inheriting from <strong>SomeIpPayload</strong> which is imported from <strong>someipy.serialization</strong>. The <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/serialization.py">someipy.serialization module</a> also provides various datatypes that need to be used for the interface definition like <strong>Uint8</strong>, <strong>Uint32</strong>, <strong>Float32</strong> or <strong>SomeIpFixedSizeArray</strong>.</p> <p>Create a new file <em>temperature_msg.py</em> with the following content:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="n">someipy.serialization</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SomeIpPayload</span><span class="p">,</span>
    <span class="n">SomeIpFixedSizeArray</span><span class="p">,</span>
    <span class="n">Uint8</span><span class="p">,</span>
    <span class="n">Uint64</span><span class="p">,</span>
    <span class="n">Float32</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Version</span><span class="p">(</span><span class="n">SomeIpPayload</span><span class="p">):</span>
    <span class="n">major</span><span class="p">:</span> <span class="n">Uint8</span>
    <span class="n">minor</span><span class="p">:</span> <span class="n">Uint8</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">major</span> <span class="o">=</span> <span class="nc">Uint8</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">minor</span> <span class="o">=</span> <span class="nc">Uint8</span><span class="p">()</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TemparatureMsg</span><span class="p">(</span><span class="n">SomeIpPayload</span><span class="p">):</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Version</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Uint64</span>
    <span class="n">measurements</span><span class="p">:</span> <span class="n">SomeIpFixedSizeArray</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">version</span> <span class="o">=</span> <span class="nc">Version</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="nc">Uint64</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="nc">SomeIpFixedSizeArray</span><span class="p">(</span><span class="n">Float32</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</code></pre></div></div> <h2 id="asyncio-app-implementation"> <a href="#asyncio-app-implementation" class="anchor-heading" aria-labelledby="asyncio-app-implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> asyncio App Implementation </h2> <p>someipy is an <a href="https://docs.python.org/3/library/asyncio.html">asyncio</a> based Python library, since multiple concurrent tasks are running in the SOME/IP implementation for service discovery, waiting for new clients or waiting on new data.</p> <p>First we will setup our applicationâ€™s structure. Typically in an asyncio application, a main coroutine-function is added which is executed using <a href="https://docs.python.org/3/library/asyncio-runner.html#id1">asyncio.run</a>. Our applicationâ€™s logic will be added inside the main coroutine-function <em>async def main</em>.</p> <p>Create a new file called <em>send_events_udp.py</em> with the following content:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">import</span> <span class="n">ipaddress</span>
<span class="kn">import</span> <span class="n">logging</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="c1"># .. our application will go here
</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Application cancelled..</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Cleanup..</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">End main task..</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
    <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></div> <h2 id="someipy-logging"> <a href="#someipy-logging" class="anchor-heading" aria-labelledby="someipy-logging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> someipy Logging </h2> <p>At the beginning of the applicatino the someipy logging level is configured. Logging levels can be chosen from the <a href="https://docs.python.org/3/library/logging.html#logging-levels">Python3 logging module levels</a>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">logging</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># .. our application will go here
</span>    <span class="nf">set_someipy_log_level</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
</code></pre></div></div> <h2 id="starting-service-discovery"> <a href="#starting-service-discovery" class="anchor-heading" aria-labelledby="starting-service-discovery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starting Service Discovery </h2> <p>Before defining and instatiating our SOME/IP service, a <em>ServiceDiscoveryProtocol</em> class has to be instantiated and started. The <em>ServiceDiscoveryProtocol</em> object will take care of receiving and sending all service discovery messages on the service discovery multicast group which is typically <em>224.224.224.245</em> and on port 30490. Also the IP address of the own used network interface has to be provided. In this example localhost is used and <em>127.0.0.1</em> is passed. The construction can be done using the factory function <em>construct_service_discovery</em> from the module <em>someipy.service_discovery</em>.</p> <p>Make sure to close the service discovery at the end of your application to ensure ports are freed correctly using the <em>close()</em> method.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">someipy.service_discovery</span> <span class="kn">import</span> <span class="n">construct_service_discovery</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># .. our application will go here
</span>    <span class="nf">set_someipy_log_level</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">SD_MULTICAST_GROUP</span> <span class="o">=</span> <span class="sh">"</span><span class="s">224.224.224.245</span><span class="sh">"</span>
    <span class="n">SD_PORT</span> <span class="o">=</span> <span class="mi">30490</span>
    <span class="n">INTERFACE_IP</span> <span class="o">=</span> <span class="sh">"</span><span class="s">127.0.0.1</span><span class="sh">"</span>
    <span class="n">service_discovery</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">construct_service_discovery</span><span class="p">(</span>
            <span class="n">SD_MULTICAST_GROUP</span><span class="p">,</span> <span class="n">SD_PORT</span><span class="p">,</span> <span class="n">INTERFACE_IP</span>
        <span class="p">)</span>

    <span class="c1"># ...
</span>    <span class="k">finally</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Service Discovery close..</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">service_discovery</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <h2 id="defining-the-someip-service"> <a href="#defining-the-someip-service" class="anchor-heading" aria-labelledby="defining-the-someip-service"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defining the SOME/IP Service </h2> <p>For offering a SOME/IP service, you first define a <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/service.py#L27">Service</a> containing <strong>EventGroups</strong> or <strong>Methods</strong> using the <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/service.py#L65">ServiceBuilder</a>. Afterwards the Service can be instantiated as a Server- or Client-Instance.</p> <p>In this example a <em>temparature_service</em> with service id 0x1234 containing a single event group with id 0x0321 which in turn contains a single event with id 0x0123. The service has a major version 1 and minor version 0:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">someipy</span> <span class="kn">import</span> <span class="n">ServiceBuilder</span><span class="p">,</span> <span class="n">EventGroup</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># ...
</span>    <span class="n">service_discovery</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">construct_service_discovery</span><span class="p">(</span>
            <span class="n">SD_MULTICAST_GROUP</span><span class="p">,</span> <span class="n">SD_PORT</span><span class="p">,</span> <span class="n">INTERFACE_IP</span>
        <span class="p">)</span>
    
    <span class="n">SAMPLE_SERVICE_ID</span> <span class="o">=</span> <span class="mh">0x1234</span>
    <span class="n">SAMPLE_EVENTGROUP_ID</span> <span class="o">=</span> <span class="mh">0x0321</span>
    <span class="n">SAMPLE_EVENT_ID</span> <span class="o">=</span> <span class="mh">0x0123</span>
    
    <span class="n">temperature_eventgroup</span> <span class="o">=</span> <span class="nc">EventGroup</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">SAMPLE_EVENTGROUP_ID</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="p">[</span><span class="n">SAMPLE_EVENT_ID</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">temperature_service</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nc">ServiceBuilder</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">with_service_id</span><span class="p">(</span><span class="n">SAMPLE_SERVICE_ID</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">with_major_version</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">with_eventgroup</span><span class="p">(</span><span class="n">temperature_eventgroup</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># ...
</span></code></pre></div></div> <h2 id="instantiating-the-someip-service"> <a href="#instantiating-the-someip-service" class="anchor-heading" aria-labelledby="instantiating-the-someip-service"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Instantiating the SOME/IP Service </h2> <p>Once the <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/service.py#L27">Service</a> is defined it can be instantiated multiple times. For offering a <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/service.py#L27">Service</a> in someipy the <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/server_service_instance.py">ServerServiceInstance</a> class is used. For using a service as client the <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/client_service_instance.py">ClientServiceInstance</a> class is used.</p> <p>Since the construction of <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/server_service_instance.py">ServerServiceInstance</a> is not trivial, the <em>construct_server_service_instance</em> factory function is provided. Following information has to be passed to the function:</p> <ul> <li>The <em>Service</em> object (defined above)</li> <li>A service instance ID (0x5678 in this example)</li> <li>An endpoint tuple consisting of IP and port on which the service is offered (127.0.0.1 and port 3000 in this example)</li> <li>The TTL (time to live) of the service discovery offer messages (5 seconds in this example)</li> <li>The <em>ServiceDiscoveryProtocol</em> object (defined above)</li> <li>The period of the service discovery offer messages in milliseconds (2000 ms in this example)</li> <li>The protocol of the service instance: Either TransportLayerProtocol.UDP or TransportLayerProtocol.TCP</li> </ul> <p>After instantiating the Service using the <em>construct_server_service_instance</em> function, the returned <em>ServerServiceInstance</em> has to be attached to the <em>ServiceDiscoveryProtocol</em> object. This is needed so that the <em>ServerServiceInstance</em> is informed about subscriptions by clients.</p> <p>Finally the SOME/IP service can be offered using the <em>start_offer</em> method. When exiting your application make sure to use <em>stop_offer</em> method on the service instance.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">someipy</span> <span class="kn">import</span> <span class="n">TransportLayerProtocol</span><span class="p">,</span> <span class="n">construct_server_service_instance</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># ...
</span>
    <span class="n">SAMPLE_INSTANCE_ID</span> <span class="o">=</span> <span class="mh">0x5678</span>
    <span class="n">service_instance_temperature</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">construct_server_service_instance</span><span class="p">(</span>
        <span class="n">temperature_service</span><span class="p">,</span>
        <span class="n">instance_id</span><span class="o">=</span><span class="n">SAMPLE_INSTANCE_ID</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="o">=</span><span class="p">(</span>
            <span class="n">ipaddress</span><span class="p">.</span><span class="nc">IPv4Address</span><span class="p">(</span><span class="n">INTERFACE_IP</span><span class="p">),</span>
            <span class="mi">3000</span><span class="p">,</span>
        <span class="p">),</span>  <span class="c1"># src IP and port of the service
</span>        <span class="n">ttl</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">sd_sender</span><span class="o">=</span><span class="n">service_discovery</span><span class="p">,</span>
        <span class="n">cyclic_offer_delay_ms</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">protocol</span><span class="o">=</span><span class="n">TransportLayerProtocol</span><span class="p">.</span><span class="n">UDP</span>
    <span class="p">)</span>

    <span class="c1"># The service instance has to be attached to the ServiceDiscoveryProtocol object, so that 
</span>    <span class="c1"># the service instance is notified about subscriptions from other ECUs
</span>    <span class="n">service_discovery</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">service_instance_temperature</span><span class="p">)</span>
    
    <span class="c1"># Starts sending periodic SD offer messages
</span>    <span class="n">service_instance_temperature</span><span class="p">.</span><span class="nf">start_offer</span><span class="p">()</span>

    <span class="c1"># ...
</span>    <span class="c1"># Before exiting the app: service_instance_temperature.stop_offer()
</span></code></pre></div></div> <h2 id="sending-events"> <a href="#sending-events" class="anchor-heading" aria-labelledby="sending-events"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sending Events </h2> <p>Until now you have defined</p> <ul> <li>a datatype <em>TemperatureMsg</em></li> <li>started the service discovery</li> <li>defined a SOME/IP dervice called <em>temperature_service</em> containing a single event</li> <li>and instantiated and offered the service using a <a href="https://github.com/chrizog/someipy/blob/master/src/someipy/server_service_instance.py">ServerServiceInstance</a> object.</li> </ul> <p>Now it is time to send events to subscribed clients. First some data has to be prepared: Import and instantiate the <em>TemperatureMsg</em> and fill it with some data:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">someipy.serialization</span> <span class="kn">import</span> <span class="n">Uint8</span><span class="p">,</span> <span class="n">Uint64</span><span class="p">,</span> <span class="n">Float32</span>
<span class="kn">from</span> <span class="n">temperature_msg</span> <span class="kn">import</span> <span class="n">TemparatureMsg</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># ...
</span>    <span class="n">tmp_msg</span> <span class="o">=</span> <span class="nc">TemparatureMsg</span><span class="p">()</span>

    <span class="n">tmp_msg</span><span class="p">.</span><span class="n">version</span><span class="p">.</span><span class="n">major</span> <span class="o">=</span> <span class="nc">Uint8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tmp_msg</span><span class="p">.</span><span class="n">version</span><span class="p">.</span><span class="n">minor</span> <span class="o">=</span> <span class="nc">Uint8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tmp_msg</span><span class="p">.</span><span class="n">measurements</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Float32</span><span class="p">(</span><span class="mf">20.0</span><span class="p">)</span>
    <span class="n">tmp_msg</span><span class="p">.</span><span class="n">measurements</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Float32</span><span class="p">(</span><span class="mf">21.0</span><span class="p">)</span>
    <span class="n">tmp_msg</span><span class="p">.</span><span class="n">measurements</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Float32</span><span class="p">(</span><span class="mf">22.0</span><span class="p">)</span>
    <span class="n">tmp_msg</span><span class="p">.</span><span class="n">measurements</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Float32</span><span class="p">(</span><span class="mf">23.0</span><span class="p">)</span>
    <span class="c1"># ...
</span></code></pre></div></div> <p>Afterwards we will start an endless loop sending data every second using the <em>send_event</em> method on the service instance. The <em>send_event</em> method takes a bytes-object which can be retrieved serializing the <em>TemperatureMsg</em>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># ...
</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Cyclically send events in an endless loop..
</span>        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tmp_msg</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="nc">Uint64</span><span class="p">(</span><span class="n">tmp_msg</span><span class="p">.</span><span class="n">timestamp</span><span class="p">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">tmp_msg</span><span class="p">.</span><span class="nf">serialize</span><span class="p">()</span>
            <span class="n">service_instance_temperature</span><span class="p">.</span><span class="nf">send_event</span><span class="p">(</span>
                <span class="n">SAMPLE_EVENTGROUP_ID</span><span class="p">,</span> <span class="n">SAMPLE_EVENT_ID</span><span class="p">,</span> <span class="n">payload</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Stop offering service..</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">service_instance_temperature</span><span class="p">.</span><span class="nf">stop_offer</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Service Discovery close..</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">service_discovery</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

        <span class="c1"># ...
</span></code></pre></div></div> <h2 id="starting-the-application"> <a href="#starting-the-application" class="anchor-heading" aria-labelledby="starting-the-application"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starting the application </h2> <p>Finally it is time to start the application. If you are using Linux, make sure to join the multicast group for your network interface used for the service discovery. In our example we use 224.224.224.245 and the loopback interface. Make sure to adjust the command for your project. Otherwise it will not be possible for clients to subscribe to your SOME/IP service.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ip addr add 224.224.224.245 dev lo autojoin
</code></pre></div></div> <p>Afterwards start your app:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 send_events_udp.py
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
